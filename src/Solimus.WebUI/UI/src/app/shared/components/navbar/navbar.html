<nav class="navbar" [class.guest-mode]="!isAuthenticated()">
  <div class="navbar-container">

    @if (isAuthenticated()) {
    <div class="navbar-left">
      <button tuiButton appearance="flat" size="s" class="sidebar-toggle desktop-only" (click)="toggleSidebar()"
        [attr.aria-label]="sidebarCollapsed() ? 'Развернуть меню' : 'Свернуть меню'">
        <tui-icon [icon]="sidebarCollapsed() ? '@tui.panel-left-open' : '@tui.panel-left-close'"
          class="toggle-icon"></tui-icon>
      </button>

      <button tuiButton appearance="flat" size="s" class="menu-toggle mobile-only" (click)="toggleMobileMenu()"
        [attr.aria-expanded]="mobileMenuOpen()" aria-label="Открыть меню">
        <div class="hamburger" [class.open]="mobileMenuOpen()">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </button>

      <a routerLink="/" class="navbar-logo">
        <div class="logo-icon">
          <svg viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="10" y="10" width="180" height="180" rx="30" class="logo-bg" />
            <path class="logo-letter" transform="translate(100 100) skewX(-14) translate(-100 -100)" d="
                              M 130 46
                              C 92 26, 44 44, 44 100
                              C 44 156, 92 174, 130 154
                              L 122 140
                              C 94 154, 66 136, 66 100
                              C 66 64, 94 46, 122 60
                              Z

                              M 116 72
                              C 92 60, 72 72, 72 100
                              C 72 128, 92 140, 116 128
                              C 98 132, 86 120, 86 100
                              C 86 80, 98 68, 116 72
                              Z
                            " fill-rule="evenodd" />
          </svg>
        </div>
        <span class="logo-text">Cyberius</span>
      </a>
    </div>

    <div class="navbar-center">
      <div class="search-box">
        <tui-icon icon="@tui.search" class="search-icon"></tui-icon>
        <input type="text" placeholder="Поиск..." class="search-input" />
        <kbd class="search-kbd">⌘K</kbd>
      </div>
    </div>

    <div class="navbar-right">
      <button tuiButton appearance="flat" size="s" class="action-btn" aria-label="Уведомления">
        <tui-icon icon="@tui.bell" class="action-icon"></tui-icon>
        <span class="notification-badge">3</span>
      </button>

      <button tuiButton appearance="flat" size="s" class="action-btn theme-toggle" (click)="toggleTheme()"
        [attr.aria-label]="isDark() ? 'Светлая тема' : 'Тёмная тема'">
        <tui-icon [icon]="isDark() ? '@tui.sun' : '@tui.moon'" class="action-icon"></tui-icon>
      </button>

      <div [tuiDropdown]="userDropdown" [tuiDropdownOpen]="userDropdownOpen"
        (tuiDropdownOpenChange)="userDropdownOpen = $event">
        <button tuiButton appearance="flat" size="s" class="user-btn" aria-label="Профиль"
          (click)="toggleUserDropdown()">
          <div class="user-avatar">
            <span>{{ currentUser()?.name?.charAt(0) || 'U' }}</span>
          </div>
          <tui-icon icon="@tui.chevron-down" class="chevron-icon" [class.open]="userDropdownOpen"></tui-icon>
        </button>
      </div>

      <ng-template #userDropdown>
        <div class="user-dropdown-menu">
          <div class="user-info">
            <div class="user-avatar-large">
              <span>{{ currentUser()?.name?.charAt(0) || 'U' }}</span>
            </div>
            <div class="user-details">
              <div class="user-name">{{ currentUser()?.name || 'Пользователь' }}</div>
              <div class="user-email">{{ currentUser()?.email || '' }}</div>
            </div>
          </div>
          <div class="dropdown-divider"></div>
          <a routerLink="/account" class="dropdown-item" (click)="closeUserDropdown()">
            <tui-icon icon="@tui.user" class="dropdown-icon"></tui-icon>
            <span>Аккаунт</span>
          </a>
          <button class="dropdown-item logout-item" (click)="logout()">
            <tui-icon icon="@tui.log-out" class="dropdown-icon"></tui-icon>
            <span>Выход</span>
          </button>
        </div>
      </ng-template>
    </div>

    } @else {
    <div class="navbar-left guest-spacer"></div>

    <div class="navbar-center-logo">
      <a routerLink="/" class="navbar-logo centered">
        <div class="logo-icon">
          <svg viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="10" y="10" width="180" height="180" rx="30" class="logo-bg" />
            <path class="logo-letter" transform="translate(100 100) skewX(-14) translate(-100 -100)" d="
                              M 130 46
                              C 92 26, 44 44, 44 100
                              C 44 156, 92 174, 130 154
                              L 122 140
                              C 94 154, 66 136, 66 100
                              C 66 64, 94 46, 122 60
                              Z

                              M 116 72
                              C 92 60, 72 72, 72 100
                              C 72 128, 92 140, 116 128
                              C 98 132, 86 120, 86 100
                              C 86 80, 98 68, 116 72
                              Z
                            " fill-rule="evenodd" />
          </svg>
        </div>
        <span class="logo-text">Cyberius</span>
      </a>
    </div>

    <div class="navbar-right guest-actions">
      <button tuiButton appearance="flat" size="s" class="action-btn theme-toggle" (click)="toggleTheme()"
        [attr.aria-label]="isDark() ? 'Светлая тема' : 'Тёмная тема'">
        <tui-icon [icon]="isDark() ? '@tui.sun' : '@tui.moon'" class="action-icon"></tui-icon>
      </button>

      <div [tuiDropdown]="authDropdown" [tuiDropdownOpen]="authDropdownOpen"
        (tuiDropdownOpenChange)="authDropdownOpen = $event">
        <button tuiButton appearance="primary" size="s" class="auth-dropdown-btn" (click)="toggleAuthDropdown()">
          <span>Войти</span>
          <tui-icon icon="@tui.chevron-down" class="dropdown-chevron" [class.open]="authDropdownOpen"></tui-icon>
        </button>
      </div>

      <ng-template #authDropdown>
        <div class="auth-dropdown-menu">
          <a routerLink="/login" class="dropdown-item" (click)="closeAuthDropdown()">
            <tui-icon icon="@tui.log-in" class="dropdown-icon"></tui-icon>
            <span>Авторизация</span>
          </a>
          <a routerLink="/register" class="dropdown-item" (click)="closeAuthDropdown()">
            <tui-icon icon="@tui.user-plus" class="dropdown-icon"></tui-icon>
            <span>Регистрация</span>
          </a>
        </div>
      </ng-template>
    </div>
    }

  </div>
</nav>